{"id":"worktree-v2-10","title":"Implement StepHandler to wire backends to executor","description":"The CLI currently only does dry-run. Need a StepHandler implementation that:\n- Takes a Backends container\n- Implements the handler protocol expected by Executor\n- Translates WorkflowStep commands to actual backend calls\n- Handles errors and updates step status\n\nThis enables end-to-end execution beyond dry-run mode.\n\nAcceptance criteria:\n- [ ] StepHandler class implements handler protocol\n- [ ] Executor.run() with StepHandler executes real backend operations\n- [ ] Error handling propagates backend failures properly\n- [ ] Tests cover success and failure paths","status":"open","priority":2,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-10T07:10:55.047271-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:10:55.047271-07:00"}
{"id":"worktree-v2-11","title":"Add --verbose/--quiet flags for output control","description":"Add output verbosity control to worktree.py CLI:\n- --verbose (-v): Show detailed progress, backend commands, timing\n- --quiet (-q): Suppress non-error output\n- Default: Normal output level\n\nAcceptance criteria:\n- [ ] --verbose shows detailed execution info\n- [ ] --quiet suppresses non-essential output  \n- [ ] Flags work with all subcommands (run, list, resume, cleanup)\n- [ ] Tests verify output levels","status":"open","priority":3,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-10T07:11:01.240982-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:01.240982-07:00"}
{"id":"worktree-v2-12","title":"Extend resume command to restart agent process","description":"The resume command currently just prints worktree info. Extend it to:\n- Detect if agent process is still running\n- If stopped, offer to restart it\n- Load checkpoint state and resume from last completed step\n- Re-establish terminal session for the resumed agent\n\nAcceptance criteria:\n- [ ] Detects running vs stopped agent state\n- [ ] Can restart stopped agent from checkpoint\n- [ ] Resumes execution from last completed step\n- [ ] Works with both sandbox and local modes","status":"open","priority":3,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-10T07:11:07.590358-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:07.590358-07:00"}
{"id":"worktree-v2-13","title":"Add pyproject.toml console_scripts entry point","description":"Slash commands reference 'python scripts/cli/worktree.py'. Add proper entry point:\n\nIn pyproject.toml:\n[project.scripts]\nworktree = \"cli.worktree:app\"\n\nThis enables:\n- 'uv run worktree run ...' instead of 'uv run python scripts/cli/worktree.py run ...'\n- Cleaner slash command definitions\n- Standard Python packaging practice\n\nAcceptance criteria:\n- [ ] console_scripts entry point defined in pyproject.toml\n- [ ] 'uv run worktree --help' works\n- [ ] Slash commands updated to use entry point\n- [ ] Existing tests still pass","status":"open","priority":4,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-10T07:11:15.089315-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:15.089315-07:00"}
{"id":"worktree-v2-4v1","title":"Epic: CLI \u0026 Commands","status":"closed","priority":3,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:47.633067-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T06:47:55.653279-07:00","closed_at":"2026-02-10T06:47:55.653279-07:00","close_reason":"All CLI tasks complete - unified worktree.py with run/list/resume/cleanup subcommands","dependencies":[{"issue_id":"worktree-v2-4v1","depends_on_id":"worktree-v2-8h9","type":"blocks","created_at":"2026-02-07T16:54:32.05772-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-4v1","depends_on_id":"worktree-v2-9qs","type":"blocks","created_at":"2026-02-07T16:54:32.785879-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-4v1.1","title":"ralph.py CLI with all flags","description":"CLI entry point with flags: --repo, --task, --branch, --context-file, --dry-run, --force, --sandbox-name. Parse args, call Planner, run Executor.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:27.541679-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T06:47:51.175953-07:00","closed_at":"2026-02-10T06:47:51.175953-07:00","close_reason":"Implemented unified worktree.py CLI with typer","dependencies":[{"issue_id":"worktree-v2-4v1.1","depends_on_id":"worktree-v2-4v1","type":"parent-child","created_at":"2026-02-07T16:49:27.542383-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-4v1.2","title":"spawn.py CLI (simpler, no Docker)","description":"Simpler CLI that uses --dangerously-skip-permissions instead of Docker sandbox. For local development without sandbox overhead.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:29.374851-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T06:47:51.176027-07:00","closed_at":"2026-02-10T06:47:51.176027-07:00","close_reason":"Implemented unified worktree.py CLI with typer","dependencies":[{"issue_id":"worktree-v2-4v1.2","depends_on_id":"worktree-v2-4v1","type":"parent-child","created_at":"2026-02-07T16:49:29.375641-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-4v1.3","title":"Slash command .md files","description":"Create command markdown files: spawn.md, ralph.md, list.md, resume.md, cleanup.md. Each invokes appropriate CLI with $ARGUMENTS.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:31.283964-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T06:47:51.176036-07:00","closed_at":"2026-02-10T06:47:51.176036-07:00","close_reason":"Implemented unified worktree.py CLI with typer","dependencies":[{"issue_id":"worktree-v2-4v1.3","depends_on_id":"worktree-v2-4v1","type":"parent-child","created_at":"2026-02-07T16:49:31.284723-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-4v1.4","title":"Resume and cleanup commands","description":"resume.py: reattach to existing worktree/sandbox. cleanup.py: remove merged worktrees, stale sandboxes, registry entries.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:32.822696-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T06:47:51.176039-07:00","closed_at":"2026-02-10T06:47:51.176039-07:00","close_reason":"Implemented unified worktree.py CLI with typer","dependencies":[{"issue_id":"worktree-v2-4v1.4","depends_on_id":"worktree-v2-4v1","type":"parent-child","created_at":"2026-02-07T16:49:32.823768-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9","title":"Epic: Backends","status":"closed","priority":1,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:46.526462-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T20:26:37.871632981Z","closed_at":"2026-02-09T20:26:37.871632981Z","close_reason":"All backend tasks complete: Docker, Git, Terminal, Factory, and Auth backends implemented with full test coverage.","dependencies":[{"issue_id":"worktree-v2-8h9","depends_on_id":"worktree-v2-9e1","type":"blocks","created_at":"2026-02-07T16:54:33.918474-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9.1","title":"DockerBackend (Real, Mock, DryRun)","description":"Create DockerBackend protocol with: sandbox_exists(), create_sandbox(), start_sandbox(), exec_in_sandbox(), run_agent(). Implement RealDockerBackend, MockDockerBackend, DryRunDockerBackend.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:09.525746-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:16.477934612Z","closed_at":"2026-02-09T19:58:16.477934612Z","close_reason":"Implemented in PR #2: DockerBackend protocol + Real/Mock/DryRun, 32 tests (2 integration)","dependencies":[{"issue_id":"worktree-v2-8h9.1","depends_on_id":"worktree-v2-8h9","type":"parent-child","created_at":"2026-02-07T16:49:09.526412-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9.2","title":"GitBackend (Real, Mock, DryRun)","description":"Create GitBackend protocol with: clone(), create_worktree(), fetch(), checkout(), ensure_local(). Implement RealGitBackend, MockGitBackend, DryRunGitBackend.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:10.956419-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:17.622736863Z","closed_at":"2026-02-09T19:58:17.622736863Z","close_reason":"Implemented in PR #2: GitBackend protocol + Real/Mock/DryRun, ensure_local with filesystem search, 54 tests","dependencies":[{"issue_id":"worktree-v2-8h9.2","depends_on_id":"worktree-v2-8h9","type":"parent-child","created_at":"2026-02-07T16:49:10.957218-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9.3","title":"TerminalBackend (Real, Mock, DryRun)","description":"Create TerminalBackend protocol with: spawn(), wait(), is_running(). Implement RealTerminalBackend, MockTerminalBackend, DryRunTerminalBackend. Handle iTerm, Terminal.app, WezTerm.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:12.517904-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:19.219361489Z","closed_at":"2026-02-09T19:58:19.219361489Z","close_reason":"Implemented in PR #2: TerminalBackend protocol + Real/Mock/DryRun, 22 tests","dependencies":[{"issue_id":"worktree-v2-8h9.3","depends_on_id":"worktree-v2-8h9","type":"parent-child","created_at":"2026-02-07T16:49:12.518628-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9.4","title":"Backend factory and dependency injection","description":"Create BackendFactory that constructs appropriate backends based on mode (real, mock, dryrun). Wire into Executor constructor for clean dependency injection.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:14.477258-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:20.127365406Z","closed_at":"2026-02-09T19:58:20.127365406Z","close_reason":"Implemented in PR #2: BackendMode enum, Backends container, create_backends factory, 9 tests","dependencies":[{"issue_id":"worktree-v2-8h9.4","depends_on_id":"worktree-v2-8h9","type":"parent-child","created_at":"2026-02-07T16:49:14.477997-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-8h9.4","depends_on_id":"worktree-v2-8h9.1","type":"blocks","created_at":"2026-02-07T16:54:44.326156-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-8h9.4","depends_on_id":"worktree-v2-8h9.2","type":"blocks","created_at":"2026-02-07T16:54:45.066466-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-8h9.4","depends_on_id":"worktree-v2-8h9.3","type":"blocks","created_at":"2026-02-07T16:54:45.711598-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-8h9.5","title":"AuthBackend (Real, Mock, DryRun)","description":"Create AuthBackend protocol with Real, Mock, and DryRun implementations.\n\n## Why this was missed\n\nThe Backends epic (PR #2) implemented Docker, Git, Terminal, and Factory backends but skipped AuthBackend. The authenticate step already exists in the Planner (planner.py:102-112) and Executor (executor.py:43 maps \"authenticate\" to AUTHENTICATING state), but there is no backend to actually perform the auth operations. Without this, the executor StepHandler has no concrete auth implementation to call.\n\n## Protocol methods\n\nAuthBackend should abstract these operations:\n- setup_git_auth(sandbox_name: str) -\u003e bool -- run gh auth setup-git inside sandbox\n- inject_token(sandbox_name: str, token: str) -\u003e bool -- write/mount GH_TOKEN into sandbox\n- validate_token(token: str, required_scopes: list[str]) -\u003e bool -- check token has needed scopes before starting agent\n- setup_ssh_key(sandbox_name: str, key_path: Path) -\u003e bool -- configure SSH key if using SSH instead of HTTPS\n\n## Implementation notes\n\n- RealAuthBackend will use DockerBackend.exec_in_sandbox() under the hood to run commands in the container -- it depends on DockerBackend being available\n- MockAuthBackend should record calls and support fail_on injection (same pattern as other mocks)\n- DryRunAuthBackend should log the commands that would be run\n- The factory (factory.py) needs to be updated to include auth in the Backends container\n- Follow the same Protocol pattern as Docker/Git/Terminal: @runtime_checkable, no __future__ annotations, quoted forward references only\n\n## Auth injection points in the workflow\n\n1. Planner creates authenticate step with params: {sandbox_name: ...} (planner.py:103-111)\n2. Executor maps \"authenticate\" action to AUTHENTICATING state (executor.py:43)\n3. The StepHandler.execute() receives this step -- needs a concrete handler that calls AuthBackend\n\n## Key consideration\n\nAuthBackend has a dependency on DockerBackend (needs exec_in_sandbox to run auth commands inside the container). This is an inter-backend dependency -- consider whether AuthBackend should take a DockerBackend in its constructor, or whether the StepHandler should mediate between them.\n\n## Acceptance criteria\n\n- [ ] AuthBackend protocol defined with @runtime_checkable\n- [ ] RealAuthBackend, MockAuthBackend, DryRunAuthBackend all satisfy protocol (isinstance checks)\n- [ ] MockAuthBackend records calls and supports fail_on\n- [ ] DryRunAuthBackend logs commands\n- [ ] Backends dataclass in factory.py updated to include auth field\n- [ ] create_backends() produces the correct auth backend for each mode\n- [ ] Tests in test_auth_backend.py covering all three implementations\n- [ ] Do NOT use from __future__ import annotations (FA100 is in ruff ignore)\n\n## Files to create/modify\n\n- Create: plugins/worktree-v2/scripts/backends/auth.py\n- Create: plugins/worktree-v2/scripts/tests/test_auth_backend.py\n- Modify: plugins/worktree-v2/scripts/backends/factory.py (add auth to Backends + create_backends)\n- Modify: plugins/worktree-v2/scripts/backends/__init__.py (export AuthBackend)","status":"closed","priority":2,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-09T19:59:04.871935385Z","created_by":"Brendan Whitney","updated_at":"2026-02-09T20:26:32.180685936Z","closed_at":"2026-02-09T20:26:32.180685936Z","close_reason":"Implemented AuthBackend protocol with Real, Mock, DryRun implementations. 27 tests, lint/format clean.","dependencies":[{"issue_id":"worktree-v2-8h9.5","depends_on_id":"worktree-v2-8h9","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"worktree-v2-9e1","title":"Epic: Core Architecture","status":"closed","priority":0,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:43.255689-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:10.486705568Z","closed_at":"2026-02-09T19:58:10.486705568Z","close_reason":"All 4 core tasks complete in PR #1: models, planner, executor, state machine"}
{"id":"worktree-v2-9e1.1","title":"Implement WorkflowStep and WorkflowPlan models","description":"Create dataclasses for WorkflowStep and WorkflowPlan in `scripts/orchestrator/models.py`.\n\n## Acceptance Criteria\n\n- [ ] `WorkflowStep` dataclass: `id`, `action`, `params`, `depends_on`\n- [ ] `WorkflowPlan` dataclass: `steps`, `metadata`, internal `_step_by_id` registry\n- [ ] `get_step(id)` returns step or None\n- [ ] `execution_order()` returns topologically sorted steps\n- [ ] `validate()` returns list of errors (empty if valid)\n- [ ] `to_json()` / `from_json()` round-trip works\n- [ ] Validation catches: missing deps, duplicate IDs, cycles\n- [ ] Tests in `tests/test_models.py`, all pass\n\n## Files\n\n- Create: `plugins/worktree-v2/scripts/orchestrator/__init__.py`\n- Create: `plugins/worktree-v2/scripts/orchestrator/models.py`\n- Create: `plugins/worktree-v2/scripts/tests/__init__.py`\n- Create: `plugins/worktree-v2/scripts/tests/test_models.py`\n\n## Verify\n\n```bash\nuv run --with pytest pytest plugins/worktree-v2/scripts/tests/test_models.py -v\n```","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:57.957293-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:57:58.472941145Z","closed_at":"2026-02-09T19:57:58.472941145Z","close_reason":"Implemented in PR #1: WorkflowStep, WorkflowPlan with validation, topo sort, JSON round-trip","dependencies":[{"issue_id":"worktree-v2-9e1.1","depends_on_id":"worktree-v2-9e1","type":"parent-child","created_at":"2026-02-07T16:48:57.958112-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9e1.2","title":"Implement Planner (creates workflow from inputs)","description":"Create Planner class that takes repo, task, mode and produces a WorkflowPlan with ordered steps: validate_repo, create_worktree, prepare_sandbox, authenticate, initialize_state, start_agent.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:00.260141-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:57:59.780087313Z","closed_at":"2026-02-09T19:57:59.780087313Z","close_reason":"Implemented in PR #1: Planner creates sandbox/local plans with correct step ordering","dependencies":[{"issue_id":"worktree-v2-9e1.2","depends_on_id":"worktree-v2-9e1","type":"parent-child","created_at":"2026-02-07T16:49:00.260802-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-9e1.2","depends_on_id":"worktree-v2-9e1.1","type":"blocks","created_at":"2026-02-07T16:54:41.316433-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9e1.3","title":"Implement Executor (runs steps, manages state)","description":"Create Executor that takes a WorkflowPlan and backends, runs each step through appropriate backend, saves checkpoints for resume, handles errors with rollback logic.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:02.543397-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:05.729880982Z","closed_at":"2026-02-09T19:58:05.729880982Z","close_reason":"Implemented in PR #1: Executor with state transitions, checkpoints, error handling","dependencies":[{"issue_id":"worktree-v2-9e1.3","depends_on_id":"worktree-v2-9e1.4","type":"blocks","created_at":"2026-02-07T16:54:43.427321-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-9e1.3","depends_on_id":"worktree-v2-9e1","type":"parent-child","created_at":"2026-02-07T16:49:02.544153-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-9e1.3","depends_on_id":"worktree-v2-9e1.1","type":"blocks","created_at":"2026-02-07T16:54:42.005032-07:00","created_by":"Brendan Whitney"},{"issue_id":"worktree-v2-9e1.3","depends_on_id":"worktree-v2-9e1.2","type":"blocks","created_at":"2026-02-07T16:54:42.744999-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9e1.4","title":"Implement state machine with transitions","description":"Create WorkflowState enum: INIT → ENSURING_REPO → CREATING_WORKTREE → PREPARING_SANDBOX → AUTHENTICATING → INITIALIZING_STATE → STARTING_AGENT → AGENT_RUNNING → COMPLETED | FAILED. Include valid_transition() checks.","status":"closed","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:04.212548-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T19:58:02.020888939Z","closed_at":"2026-02-09T19:58:02.020888939Z","close_reason":"Implemented in PR #1: WorkflowState enum with valid_transition, next_state, is_terminal","dependencies":[{"issue_id":"worktree-v2-9e1.4","depends_on_id":"worktree-v2-9e1","type":"parent-child","created_at":"2026-02-07T16:49:04.21321-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9qs","title":"Epic: State Management","status":"closed","priority":2,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:47.137937-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T21:07:24.618389241Z","closed_at":"2026-02-09T21:07:24.618389241Z","close_reason":"All 3 tasks complete: checkpoint/resume, ralph state, global registry. 58 new tests, 277 total passing.","dependencies":[{"issue_id":"worktree-v2-9qs","depends_on_id":"worktree-v2-9e1","type":"blocks","created_at":"2026-02-07T16:54:34.787548-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9qs.1","title":"Workflow checkpoint/resume","description":"Save workflow state to .ralph/workflow_state.json: workflow_id, current_state, completed_steps, sandbox_name, worktree_path, timestamps. Enable resume from checkpoint.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:18.960355-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T21:03:45.889115303Z","closed_at":"2026-02-09T21:03:45.889115303Z","close_reason":"Implemented WorkflowCheckpoint dataclass with save/load/exists functions. 15 tests covering creation, serialization, file I/O, update, and edge cases.","dependencies":[{"issue_id":"worktree-v2-9qs.1","depends_on_id":"worktree-v2-9qs","type":"parent-child","created_at":"2026-02-07T16:49:18.961168-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9qs.2","title":"Ralph state (.ralph/ directory)","description":"Manage .ralph/ directory: progress.md, config.json, guardrails.md, worktree-task.md. Include reset_ralph_state() for sandbox reuse.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:21.226121-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T21:04:56.86488292Z","closed_at":"2026-02-09T21:04:56.86488292Z","close_reason":"Implemented .ralph/ directory management with init, reset, config save/load, progress updates, and RalphState wrapper class. 22 tests.","dependencies":[{"issue_id":"worktree-v2-9qs.2","depends_on_id":"worktree-v2-9qs","type":"parent-child","created_at":"2026-02-07T16:49:21.226824-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-9qs.3","title":"Global worktree registry","description":"Track all active worktrees in ~/.claude/worktree-registry.json. Include list, add, remove, cleanup operations.","status":"closed","priority":0,"issue_type":"task","assignee":"Brendan Whitney","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:22.594761-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-09T21:06:33.485269717Z","closed_at":"2026-02-09T21:06:33.485269717Z","close_reason":"Implemented WorktreeRegistry with WorktreeEntry dataclass. Operations: list, get, add, remove, cleanup. 21 tests.","dependencies":[{"issue_id":"worktree-v2-9qs.3","depends_on_id":"worktree-v2-9qs","type":"parent-child","created_at":"2026-02-07T16:49:22.595471-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-cg0","title":"Epic: Documentation \u0026 Polish","status":"open","priority":4,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:51.970464-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-07T16:48:51.970464-07:00"}
{"id":"worktree-v2-cg0.1","title":"CLAUDE.md with project context","description":"Update CLAUDE.md to serve as the project context file for AI agents.\n\n**Location:** CLAUDE.md (repo root)\n\n**Sections to include:**\n\n1. **Quick Reference** - Common commands:\n   - Setup: uv sync --dev\n   - Tests: uv run pytest\n   - Lint: uv run ruff check/format\n   - CLI: uv run worktree --help\n\n2. **Project Overview** - What this project does (clean room orchestrator)\n\n3. **Architecture** - High-level diagram:\n   - CLI → Planner → Executor → Backends\n   - State management (checkpoint, ralph, registry)\n\n4. **Directory Structure** - What's where:\n   - scripts/cli/ - Entry points\n   - scripts/orchestrator/ - Planner, Executor\n   - scripts/backends/ - Docker, Git, Terminal, Auth\n   - scripts/state/ - Checkpoint, Ralph, Registry\n\n5. **Development Guidelines**:\n   - TDD approach\n   - Backend protocol pattern\n   - Code patterns to follow/avoid\n\n6. **Key Files** - Most important files to understand\n\nAcceptance criteria:\n- [ ] All sections present and accurate\n- [ ] Commands are copy-pasteable and work\n- [ ] Architecture diagram clear\n- [ ] New contributors can onboard quickly","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:46.36686-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:12:13.30749-07:00","dependencies":[{"issue_id":"worktree-v2-cg0.1","depends_on_id":"worktree-v2-cg0","type":"parent-child","created_at":"2026-02-07T16:49:46.367661-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-cg0.2","title":"README with usage examples","description":"Create comprehensive README.md for end users.\n\n**Location:** README.md (repo root) or plugins/worktree-v2/README.md\n\n**Sections to include:**\n\n1. **Overview** - What worktree-v2 does, why it exists\n\n2. **Installation**:\n   - Prerequisites (Python 3.11+, uv, Docker)\n   - Clone and setup\n   - Verify installation\n\n3. **Quick Start**:\n   - Spawn your first agent\n   - Basic workflow example\n\n4. **CLI Reference**:\n   - worktree run [mode] [target] --task '...'\n   - worktree list\n   - worktree resume \u003cid\u003e\n   - worktree cleanup\n   - All flags documented with examples\n\n5. **Modes and Targets**:\n   - interactive vs autonomous\n   - sandbox vs container vs local\n   - When to use each combination\n\n6. **Troubleshooting**:\n   - Common errors and fixes\n   - Docker issues\n   - Auth problems\n\n7. **Contributing** - How to develop on the project\n\nAcceptance criteria:\n- [ ] README enables first-time use without other docs\n- [ ] All CLI commands documented with examples\n- [ ] Troubleshooting covers common issues\n- [ ] Copy-paste commands work","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:47.719192-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:12:22.838542-07:00","dependencies":[{"issue_id":"worktree-v2-cg0.2","depends_on_id":"worktree-v2-cg0","type":"parent-child","created_at":"2026-02-07T16:49:47.719891-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-cg0.3","title":"Inline code documentation","description":"Add docstrings to all public functions and classes.\n\n**Scope:** All files in scripts/ that don't have adequate docstrings.\n\n**Guidelines:**\n\n1. **Focus on WHY, not WHAT** - The code shows what, explain why\n\n2. **Keep it minimal** - One line if possible, more only if needed\n\n3. **Document non-obvious behavior**:\n   - Side effects\n   - Error conditions  \n   - Threading/async considerations\n\n4. **Use Google-style docstrings**:\n   ```python\n   def func(arg: str) -\u003e bool:\n       \"\"\"Brief description of purpose.\n       \n       Args:\n           arg: What this argument is for\n           \n       Returns:\n           What the return value means\n           \n       Raises:\n           ValueError: When this happens\n       \"\"\"\n   ```\n\n5. **Skip obvious methods** - Don't document getters/setters/\\_\\_init\\_\\_ unless non-obvious\n\n**Priority order:**\n1. Backend protocols (most reused)\n2. Orchestrator (planner, executor)\n3. State management\n4. CLI entry points\n\nAcceptance criteria:\n- [ ] All Protocol classes documented\n- [ ] All public functions have docstrings\n- [ ] Docstrings explain WHY not WHAT\n- [ ] ruff DOC rules pass","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:49.382665-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:12:35.164354-07:00","dependencies":[{"issue_id":"worktree-v2-cg0.3","depends_on_id":"worktree-v2-cg0","type":"parent-child","created_at":"2026-02-07T16:49:49.383406-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-ext","title":"Epic: Testing","status":"open","priority":4,"issue_type":"epic","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:48:48.190382-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-07T16:48:48.190382-07:00","dependencies":[{"issue_id":"worktree-v2-ext","depends_on_id":"worktree-v2-9e1","type":"blocks","created_at":"2026-02-07T16:54:35.222206-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-ext.1","title":"Unit tests for planner/executor","description":"Fast unit tests for planner and executor with no external dependencies.\n\n**Location:** scripts/tests/test_planner.py, scripts/tests/test_executor.py\n\n**Planner tests:**\n- test_planner_creates_clone_step_for_new_worktree()\n- test_planner_creates_sandbox_steps_when_target_sandbox()\n- test_planner_skips_docker_for_local_target()\n- test_planner_includes_auth_step_when_token_provided()\n- test_planner_generates_unique_workflow_ids()\n\n**Executor tests:**\n- test_executor_runs_steps_in_order()\n- test_executor_handles_step_failure_gracefully()\n- test_executor_saves_checkpoint_after_each_step()\n- test_executor_can_resume_from_checkpoint()\n- test_executor_skips_completed_steps_on_resume()\n\n**Requirements:**\n- Use MockBackends for all backend operations\n- No file I/O to real filesystem (use tmp_path)\n- No subprocess calls\n- Tests should run in \u003c1 second total\n\nAcceptance criteria:\n- [ ] 10+ planner tests covering step generation\n- [ ] 10+ executor tests covering execution flow\n- [ ] All tests use MockBackends\n- [ ] Tests run fast (\u003c1s total)","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:36.81147-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:31.240912-07:00","dependencies":[{"issue_id":"worktree-v2-ext.1","depends_on_id":"worktree-v2-ext","type":"parent-child","created_at":"2026-02-07T16:49:36.812088-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-ext.2","title":"Integration tests with mock backends","description":"Integration tests that run full workflows with all backends mocked.\n\n**Location:** scripts/tests/test_integration.py\n\n**Test scenarios:**\n- test_full_sandbox_workflow_happy_path()\n- test_full_local_workflow_happy_path()\n- test_workflow_recovers_from_git_failure()\n- test_workflow_recovers_from_docker_failure()\n- test_checkpoint_persists_across_executor_instances()\n- test_registry_updated_on_workflow_complete()\n- test_ralph_state_initialized_correctly()\n\n**What to verify:**\n- Planner → Executor → Backends integration works\n- State transitions follow WorkflowState enum\n- Checkpoints save/load correctly\n- Registry tracks worktrees properly\n- Error recovery doesn't leave partial state\n\n**Requirements:**\n- Use MockBackends configured to simulate real behavior\n- Can use real filesystem (tmp_path) for state files\n- No real Docker or git subprocess calls\n\nAcceptance criteria:\n- [ ] 7+ integration scenarios covered\n- [ ] State transitions tested exhaustively\n- [ ] Checkpoint persistence verified\n- [ ] Error recovery paths tested","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:38.339981-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:40.376562-07:00","dependencies":[{"issue_id":"worktree-v2-ext.2","depends_on_id":"worktree-v2-ext","type":"parent-child","created_at":"2026-02-07T16:49:38.340599-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-ext.3","title":"E2E test script","description":"End-to-end tests that run real Docker operations.\n\n**Location:** scripts/tests/test_e2e.py\n\n**Mark all tests with:** @pytest.mark.e2e (skipped in normal runs)\n\n**Test scenarios:**\n- test_e2e_sandbox_created_and_agent_starts()\n- test_e2e_sandbox_reuse_preserves_state()\n- test_e2e_cleanup_removes_sandbox()\n- test_e2e_resume_reconnects_to_sandbox()\n\n**What to test:**\n- Real 'docker sandbox create' works\n- Real 'docker sandbox run' starts Claude\n- Workspace mounted correctly in sandbox\n- gh auth configured properly\n- Sandbox cleanup removes container\n\n**Requirements:**\n- Requires Docker installed and running\n- Use @pytest.mark.e2e decorator\n- CI runs these in separate job with Docker available\n- Local devs can skip with 'pytest -m \"not e2e\"'\n- Tests should be idempotent (clean up after themselves)\n\n**CI configuration:**\n- Add e2e job to .github/workflows/ci.yml\n- Only run on main branch or when [e2e] in commit message\n\nAcceptance criteria:\n- [ ] 4+ e2e scenarios with real Docker\n- [ ] All tests marked @pytest.mark.e2e\n- [ ] CI job configured for e2e tests\n- [ ] Tests clean up containers after running","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:40.211844-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:50.571698-07:00","dependencies":[{"issue_id":"worktree-v2-ext.3","depends_on_id":"worktree-v2-ext","type":"parent-child","created_at":"2026-02-07T16:49:40.212426-07:00","created_by":"Brendan Whitney"}]}
{"id":"worktree-v2-ext.4","title":"Dry-run verification tests","description":"Tests that verify --dry-run output shows correct commands.\n\n**Location:** scripts/tests/test_dryrun.py\n\n**Test scenarios:**\n- test_dryrun_shows_git_clone_command()\n- test_dryrun_shows_docker_sandbox_create()\n- test_dryrun_shows_docker_sandbox_run()\n- test_dryrun_shows_gh_auth_setup()\n- test_dryrun_shows_all_steps_in_order()\n- test_dryrun_includes_actual_paths_and_names()\n\n**What to verify:**\n- DryRunDockerBackend prints exact docker commands\n- DryRunGitBackend prints exact git commands\n- DryRunTerminalBackend prints spawn command\n- Commands include real values (paths, branch names, etc.)\n- Output order matches execution order\n\n**Requirements:**\n- Capture stdout from dry-run execution\n- Parse and verify command structure\n- Ensure paths/names are substituted correctly\n\nAcceptance criteria:\n- [ ] 6+ dry-run output scenarios\n- [ ] All DryRun backends have output tests\n- [ ] Commands verified to be syntactically correct\n- [ ] Variable substitution verified","status":"open","priority":0,"issue_type":"task","owner":"brendan.whitney@faraday.io","created_at":"2026-02-07T16:49:42.322936-07:00","created_by":"Brendan Whitney","updated_at":"2026-02-10T07:11:58.627881-07:00","dependencies":[{"issue_id":"worktree-v2-ext.4","depends_on_id":"worktree-v2-ext","type":"parent-child","created_at":"2026-02-07T16:49:42.32359-07:00","created_by":"Brendan Whitney"}]}
